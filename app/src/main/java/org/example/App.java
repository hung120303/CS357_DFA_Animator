/*
 * This source file was generated by the Gradle 'init' task
 */
package org.example;

import javax.swing.*;
import java.util.Set;
import java.util.HashSet;

public class App {
    public String getGreeting() {
        return "Hello World!";
    }

    public static void main(String[] args) {
		
		// Error class to check for valid input
		Error e = new Error();

        //Make the window
        JFrame lol = new JFrame("top text");
		lol.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);

        lol.setVisible(true);
        lol.setSize(1000,1000);
		lol.setLocationRelativeTo(null);  


		int states; 
		String sigma;
		String delta;
		int startState;
		String accState;
        //Get some user input. Number of states, Alphabet, Transitions, starting state, accepting states
		
		//if(JOptionPane.showInputDialog("Enter number of states (Min: 1; Max: 10): ") )
		
		
        states = e.promptStates();

        sigma = JOptionPane.showInputDialog("Enter your alphabet (Use numbers (0-9), uppercase/lowercase letters (A-Z, a-z))(Ex: a, b, 1, ..., 0): ");
        delta = JOptionPane.showInputDialog("Enter transitions (Ex: {(a, 1, 2), ... , (b, 2, 3)} ): ");
		
        startState = Integer.valueOf(JOptionPane.showInputDialog("Enter the start state (0-" + (states - 1) + "): "));
        accState = JOptionPane.showInputDialog("Enter the accepting state(s) (Ex: 0, ... , " + (states - 1) +"): ");


        Set<Character> sig = getAlphabet(sigma);
        Set<Transition> t = getTransitions(delta, states, sig);
        Set<Integer> acc = getAccStates(accState, states);

        Reader reader = new Reader(states, sig, t, startState, acc);
		
		
        System.out.println(reader);

    }

    public static Set<Character> getAlphabet(String s){
        Set<Character> sigma = new HashSet<Character>(); 
        for(int i = 0; i < s.length(); i++){ //enumerate through each char element of the intput string
            char cur = s.charAt(i);
            if( ((int)cur > 47 && (int)cur < 58) || ((int)cur > 64 && (int)cur < 91) || ((int)cur > 96 && (int)cur < 123)){ // If ascii value is 0-9, A-Za-z
                    sigma.add(cur); //add char to sigma                
            }
        }
        return sigma;
    }
    public static Set<Integer> getAccStates(String s, int numStates){
        Set<Integer> qAcc = new HashSet<Integer>(); 
        for(int i = 0; i < s.length(); i++){ //enumerate through each char element of the intput string
            char cur = s.charAt(i);
            if( ((int)cur > 47 && (int)cur < 58) ){ // If ascii value is 0-9, A-Za-z
                    int add = cur - '0';
                    if(add < numStates){
                         qAcc.add(add); //add int to qAcc    
                    }
            }
        }
        return qAcc;
    }
    public static Set<Transition> getTransitions(String s, int numStates, Set<Character> sigma){
        Set<Transition> delta = new HashSet<Transition>(); 
            if(s.charAt(0) != 123){ //input should start with '{'
                return null; //This should be an error message for invalid format
            }
            int i = 1;
            while(i < s.length()){ //until reach end of string 
                if((int)(s.charAt(i)) == 40){ // check for '('
                    char input = '~'; 
                    int from = -1;
                    int to = -1;
                    i++;
                    while((int)(s.charAt(i)) != 41){ //check for ')'
                        if(input == '~'){
                            if( ((int)(s.charAt(i)) > 47 && (int)(s.charAt(i)) < 58) || ((int)(s.charAt(i)) > 64 && (int)(s.charAt(i)) < 91) || ((int)(s.charAt(i)) > 96 && (int)(s.charAt(i)) < 123) ){
                                input = s.charAt(i);
                            }
                        }
                        else if(from == -1){
                            if( ((int)(s.charAt(i)) > 47 && (int)(s.charAt(i)) < 58) ){
                                from = s.charAt(i) - '0';
                            }                            
                        }
                        else if(to == -1){
                            if( ((int)(s.charAt(i)) > 47 && (int)(s.charAt(i)) < 58) ){
                                to = s.charAt(i) - '0';
                            }                            
                        }
                        i++;
                    }
                    if(input != '~' && from != -1 && to != -1){
                        delta.add(new Transition(input, from, to));
                    }
                    else{
                        return null;
                    }
                }
                i++;
            }
        if(isValidTransitions(delta, numStates, sigma)){
            return delta;
        }
        else{
            System.out.println("This transiton table is smelly");
            return null; 
        }
    }

    public static boolean isValidTransitions(Set<Transition> tTable, int numStates, Set<Character> sigma){
        // there should be one of each alphabet transitions for each state
        for(char c : sigma){
            int[] check = new int[numStates];
            for(Transition t: tTable){

                char curChar = t.getInput(); //We only care about the transtion symbol and the state it's coming from
                int curFrom = t.getFrom();

                if(curChar == c){
                    check[curFrom] += 1; 
                }

            }
            for(int i: check){
                if(i != 1){
                    return false; //There is not a single transition for one symbol for one state (0 or more than 1)
                }
            }
        }
        
        // there should be (# of states) * (# of characters in alphabet) transitions
        if(tTable.size() != (numStates * sigma.size())){
            return false;
        }

        return true;
    }
}
